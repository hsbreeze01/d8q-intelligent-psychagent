# 股票实时信息小程序设计文档

## 1. 文档信息
- **文档名称**：股票实时信息小程序设计文档
- **版本号**：v1.0
- **编写日期**：2025-12-19
- **编写人**：开发团队
- **审核人**：技术负责人

## 2. 项目概述
- **项目背景**：随着金融市场的发展，用户需要一个便捷的工具来获取股票实时信息和趋势。本项目旨在开发一个小程序，能够根据用户输入的股票代码或名称，获取股票当前价格和实时走势。
- **系统架构**：
  ```
  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
  │  前端页面   │────▶│  后端服务   │────▶│  akshare库  │
  │ (HTML/CSS/JS)│◀────│ (Node.js)   │◀────│ (Python)    │
  └─────────────┘     └─────────────┘     └─────────────┘
  ```

## 3. 技术栈
- **前端技术**：
  - HTML5
  - CSS3
  - JavaScript (ES6+)
  - EJS模板引擎
  - Chart.js (用于绘制蜡烛图)
- **后端技术**：
  - Node.js
  - Express框架
  - Python (用于调用akshare库)
- **数据库**：
  - 本项目暂不使用数据库，直接从akshare库获取数据
- **工具和中间件**：
  - Git (版本控制)
  - npm (依赖管理)
  - child_process (Node.js模块，用于调用Python脚本)

## 4. 架构设计
- **系统组件**：
  1. 前端组件：用户界面、图表展示、交互处理
  2. 后端组件：API服务、Python脚本调用、数据处理
  3. 数据组件：akshare库、股票数据获取
- **组件交互**：
  - 前端通过AJAX请求向后端发送股票查询请求
  - 后端通过child_process模块调用Python脚本
  - Python脚本使用akshare库获取股票数据
  - 后端将处理后的数据返回给前端
  - 前端使用Chart.js绘制蜡烛图
- **数据流**：
  1. 用户输入股票代码/名称
  2. 前端发送请求到后端API
  3. 后端调用Python脚本
  4. Python脚本获取股票数据
  5. 后端处理数据并返回JSON格式
  6. 前端解析JSON数据
  7. 前端显示股票信息和蜡烛图

## 5. 详细设计
### 5.1 前端模块
- **模块描述**：处理用户界面和交互逻辑
- **类结构**：
  - `StockApp`：主应用类，处理搜索和图表渲染
  - `CandlestickChart`：蜡烛图绘制类，使用Chart.js绘制蜡烛图
- **接口设计**：
  - `searchStock(query)`：搜索股票接口
  - `getStockInfo(code)`：获取股票信息接口
  - `getStockHistory(code)`：获取股票历史数据接口
- **实现细节**：
  - 使用EJS模板引擎渲染页面
  - 使用AJAX进行异步数据请求
  - 使用Chart.js的自定义插件绘制蜡烛图

### 5.2 后端模块
- **模块描述**：处理API请求和数据获取
- **类结构**：
  - `StockController`：股票控制器，处理股票相关的API请求
  - `PythonProcessManager`：Python进程管理器，调用Python脚本
- **接口设计**：
  - `GET /search`：搜索股票接口
  - `GET /stock-info`：获取股票信息接口
  - `GET /stock-history`：获取股票历史数据接口
- **实现细节**：
  - 使用Express框架创建API服务
  - 使用child_process模块调用Python脚本
  - 使用Promise处理异步操作

### 5.3 数据模块
- **模块描述**：获取和处理股票数据
- **类结构**：
  - `StockDataFetcher`：股票数据获取类，使用akshare库获取数据
- **接口设计**：
  - `search_stocks(query)`：搜索股票函数
  - `get_stock_info(code)`：获取股票信息函数
  - `get_stock_history(code, days)`：获取股票历史数据函数
- **实现细节**：
  - 使用akshare库获取股票数据
  - 处理数据格式，转换为JSON格式
  - 添加错误处理和日志记录

## 6. 数据库设计
- **数据库结构**：本项目暂不使用数据库，直接从akshare库获取数据
- **关系图**：无
- **索引设计**：无
- **数据迁移**：无

## 7. API设计
### 7.1 搜索股票接口
- **接口URL**：`GET /search`
- **请求参数**：
  - `query`：字符串，股票代码或名称
- **响应格式**：
  ```json
  {
    "success": true,
    "data": [
      {
        "code": "600036",
        "name": "招商银行",
        "price": 35.67
      },
      // 更多匹配的股票
    ]
  }
  ```

### 7.2 获取股票信息接口
- **接口URL**：`GET /stock-info`
- **请求参数**：
  - `code`：字符串，股票代码
- **响应格式**：
  ```json
  {
    "success": true,
    "data": {
      "code": "600036",
      "name": "招商银行",
      "price": 35.67,
      "change": 0.23,
      "changePercent": 0.65,
      "volume": 12345678
    }
  }
  ```

### 7.3 获取股票历史数据接口
- **接口URL**：`GET /stock-history`
- **请求参数**：
  - `code`：字符串，股票代码
  - `days`：整数，历史数据天数（默认30）
- **响应格式**：
  ```json
  {
    "success": true,
    "data": {
      "code": "600036",
      "name": "招商银行",
      "history": [
        {
          "date": "2025-12-18",
          "open": 35.45,
          "high": 35.80,
          "low": 35.30,
          "close": 35.67,
          "volume": 12345678
        },
        // 更多历史数据
      ]
    }
  }
  ```

## 8. 界面设计
- **页面布局**：
  ```
  ┌─────────────────────────────────────┐
  │  股票实时信息小程序                 │
  ├─────────────────────────────────────┤
  │  搜索区域：[搜索框] [搜索按钮]     │
  ├─────────────────────────────────────┤
  │  股票信息区域：                     │
  │  - 股票代码/名称                    │
  │  - 当前价格                        │
  │  - 涨跌幅/涨跌额                    │
  │  - 成交量                          │
  ├─────────────────────────────────────┤
  │  蜡烛图趋势区域：                   │
  │  - 蜡烛图展示                      │
  │  - 时间范围选择                    │
  │  - 缩放/平移功能                   │
  └─────────────────────────────────────┘
  ```
- **交互流程**：
  1. 用户在搜索框输入股票代码/名称
  2. 点击搜索按钮或按Enter键
  3. 系统显示搜索结果列表
  4. 用户选择股票
  5. 系统显示股票信息和蜡烛图
  6. 用户可以缩放/平移蜡烛图查看详细趋势
- **样式规范**：
  - 主色调：蓝色（#1E90FF）
  - 辅助色：绿色（#00FF00）表示上涨，红色（#FF0000）表示下跌
  - 字体：Arial，14px
  - 边距：统一使用10px

## 9. 安全设计
- **认证机制**：本项目暂不涉及用户认证
- **授权机制**：本项目暂不涉及用户授权
- **数据安全**：
  - 对用户输入进行验证，防止注入攻击
  - 限制API请求频率，防止恶意请求
- **防护措施**：
  - 使用CORS限制跨域请求
  - 添加错误处理，防止信息泄露

## 10. 部署设计
- **部署架构**：
  - 前端静态文件和后端服务部署在同一台服务器上
  - 使用Nginx作为反向代理
  - 使用PM2管理Node.js进程
- **环境配置**：
  - 开发环境：Node.js 18.x，Python 3.10.x
  - 测试环境：Node.js 18.x，Python 3.10.x
  - 生产环境：Node.js 18.x，Python 3.10.x
- **部署流程**：
  1. 拉取代码到服务器
  2. 安装Node.js依赖：`npm install`
  3. 安装Python依赖：`pip install -r server/requirements.txt`
  4. 启动服务：`pm2 start server/index.js`
  5. 配置Nginx反向代理
- **监控和告警**：
  - 使用PM2监控Node.js进程
  - 使用Nginx日志监控请求情况
  - 配置系统监控和告警

## 11. 测试设计
- **测试策略**：
  - 单元测试：测试各个模块的功能
  - 集成测试：测试模块之间的集成
  - 系统测试：测试整个系统的功能
  - 用户验收测试：由用户进行验收测试
- **测试用例**：
  - 股票搜索功能测试：验证能够正确搜索股票
  - 股票信息显示测试：验证能够正确显示股票信息
  - 蜡烛图绘制测试：验证能够正确绘制蜡烛图
  - 错误处理测试：验证能够正确处理错误情况
- **测试工具**：
  - 单元测试：Jest (JavaScript)，pytest (Python)
  - 集成测试：Postman
  - 性能测试：JMeter
- **性能测试**：
  - 测试搜索响应时间
  - 测试股票信息加载时间
  - 测试蜡烛图渲染时间

## 12. 维护设计
- **日志设计**：
  - 后端使用console.log记录请求和错误信息
  - 可以扩展使用winston等日志库
- **错误处理**：
  - 前端添加错误提示信息
  - 后端添加错误捕获和处理机制
- **版本管理**：
  - 使用Git进行版本控制
  - 使用语义化版本号管理版本
- **升级策略**：
  - 定期更新依赖库
  - 定期优化代码和性能

## 13. 附录
- **术语表**：
  - OHLC：开盘价(Open)、最高价(High)、最低价(Low)、收盘价(Close)
  - 蜡烛图：显示股票OHLC数据的金融图表
  - akshare：开源金融数据接口库
  - Chart.js：JavaScript图表库
- **参考文档**：
  - akshare官方文档：https://akshare.akfamily.xyz/
  - Chart.js官方文档：https://www.chartjs.org/docs/latest/
  - Node.js官方文档：https://nodejs.org/en/docs/
  - Express官方文档：https://expressjs.com/
- **设计决策**：
  - 使用Python的akshare库获取股票数据，因为它提供了丰富的金融数据接口
  - 使用Chart.js绘制蜡烛图，因为它是一个功能强大且易于使用的图表库
  - 使用Node.js + Express作为后端，因为它们轻量级且易于部署